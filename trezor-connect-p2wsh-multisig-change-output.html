<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>



    <!--<script src="https://connect.trezor.io/9/trezor-connect.js"></script>-->
  
    <script src="https://connect.trezor.io/9/trezor-connect.js"></script>
</head>
<body>

    <div>
        Word List:
        <br />
        "solar segment strike patrol broccoli witness praise tennis fat elegant yellow menu favorite upgrade grace pulp subject tribe impact head west museum pulse term"
        <br />
        Path:
        <br />
        m/48'/1'/0'/2'
        <br />
        <br />
        <br />
    </div>
    <div>
        Send To: tb1q0egy6cmrhzz69l3xn7tpndjt2dtqkk7a9mlruh
        <br />
        Send Amount: 0.004
        <br />
        Mining Fee: 0.00000189
        <br />
        Change Amount: 0.00199811
        <br />
        Change Address: tb1qvymyd4fjj0hx8gkamq60gpzzartajswmv3t9w65568s63smduryqhum7jg
        <br />
        Total: 0.00400189
    </div>
    <br />
    <br />
    Inputs Json
    <div id="inputJson"></div>

    <br />
    <br />
    Outputs Json
    <div id="outputsJson">

    </div>

    <button onclick="signTrezorMultisig()" value="Sign">Button</button>

    <br />
    <p>Trezor returns transaction below, the change address has become non multisig pay-to-script-hash, the multisig part was ignored</p>


    <p id="signResult"></p>

    <p>
        {
        "addresses": [
        "2N4vsqahj4bMwWzgSLYDAfRxY2aZJBaT7Zu",
        "tb1q0egy6cmrhzz69l3xn7tpndjt2dtqkk7a9mlruh"
        ],
        "block_height": -1,
        "block_index": -1,
        "confirmations": 0,
        "double_spend": false,
        "fees": 0,
        "hash": "c6f0563be7ac16c08c551fcc1f019c08b6c9bbcb545c52660472dfdd70cc0c5a",
        "inputs": [
        {
        "age": 0,
        "output_index": 0,
        "prev_hash": "a48aa3de3a0d5e82625d004ac316c8dbbe7a0b2380dd632f974e0513b0a181ef",
        "script_type": "empty",
        "sequence": 4294967295
        }
        ],
        "outputs": [
        {
        "addresses": [
        "2N4vsqahj4bMwWzgSLYDAfRxY2aZJBaT7Zu"
        ],
        "script": "a914802933a1fce0389e78690962ea3a61a9a72c7cbd87",
        "script_type": "pay-to-script-hash",
        "value": 199811
        },
        {
        "addresses": [
        "tb1q0egy6cmrhzz69l3xn7tpndjt2dtqkk7a9mlruh"
        ],
        "script": "00147e504d6363b885a2fe269f9619b64b53560b5bdd",
        "script_type": "pay-to-witness-pubkey-hash",
        "value": 400000
        }
        ],
        "preference": "low",
        "received": "2022-09-09T11:52:15.825404034Z",
        "relayed_by": "3.237.48.18",
        "size": 224,
        "total": 599811,
        "ver": 2,
        "vin_sz": 1,
        "vout_sz": 2,
        "vsize": 142
        }
    </p>

    <script type="text/javascript">

        var inputs =
            [
                {
                    "address_n": [2147483696, 2147483649, 2147483648, 2147483650, 0, 13],
                    "prev_index": 0,
                    "prev_hash": "a48aa3de3a0d5e82625d004ac316c8dbbe7a0b2380dd632f974e0513b0a181ef",
                    "script_type": "SPENDWITNESS",
                    "multisig": {
                        "pubkeys": [
                            {
                                "node": "tpubDEAEqUEydwjFkvZrk63u5qnhyQkMct2h7mmhUvue2GYACSygeyiDCXV5g59bs5Nursa3nAEWy1UamZaLL37tBqwVVLdhr9LzpkA7hdK2K3j",
                                "address_n": [0, 13]
                            },
                            {
                                "node": "tpubDEFGNNrhcGZYq8i21XtJBfQqoktvRs3vmGT8nvS31QFgDMzPtLDyowdLLBMNf7fMQ7EBXCovagQctkFoXJqmUGeN4RzP3U7LKxzVp8R5YMu",
                                "address_n": [0, 13]
                            },
                            {
                                "node": "tpubDEkumAckjusYPWdDBUm1HPg7tcJHAMRFfChXyBRu4Cyae6EteY3wekSh4rMmEVwPqiqY3CtZovtnR2X9dS7nbZ56C9hvpPiqtitDdvKCYFv",
                                "address_n": [0, 13]
                            }
                        ],
                        "signatures": [],
                        "m": 2
                    },
                    "amount": "600000"
                }
            ]

        var outputs =
            [
                {
                    "address_n": [2147483696, 2147483649, 2147483648, 2147483650, 1, 1],
                    "script_type": "PAYTOMULTISIG", //Setting this to PAYTOWITNESS causes trezor to prompt to change it back to PAYTOMULTISIG
                    "amount": "199811",
                    "multisig": {
                        "pubkeys": [
                            {
                                "node": "tpubDEAEqUEydwjFkvZrk63u5qnhyQkMct2h7mmhUvue2GYACSygeyiDCXV5g59bs5Nursa3nAEWy1UamZaLL37tBqwVVLdhr9LzpkA7hdK2K3j",
                                "address_n": [1, 1]
                            },
                            {
                                "node": "tpubDEFGNNrhcGZYq8i21XtJBfQqoktvRs3vmGT8nvS31QFgDMzPtLDyowdLLBMNf7fMQ7EBXCovagQctkFoXJqmUGeN4RzP3U7LKxzVp8R5YMu",
                                "address_n": [1, 1]
                            },
                            {
                                "node": "tpubDEkumAckjusYPWdDBUm1HPg7tcJHAMRFfChXyBRu4Cyae6EteY3wekSh4rMmEVwPqiqY3CtZovtnR2X9dS7nbZ56C9hvpPiqtitDdvKCYFv",
                                "address_n": [1, 1]
                            }
                           
                        ],
                        "signatures": [],
                        "m": 2
                    }
                },
                {
                    "script_type": "PAYTOADDRESS",
                    "amount": "400000",
                    "address": "tb1q0egy6cmrhzz69l3xn7tpndjt2dtqkk7a9mlruh"
                }
            ]

        document.getElementById("inputJson").innerHTML = JSON.stringify(inputs);
        document.getElementById("outputsJson").innerHTML = JSON.stringify(outputs);


        var coinNetwork = "Testnet";

        window.signTrezorMultisig = async () => { //TODO? Take one arg for inputs outputs, can reduce calling code
         

            TrezorConnect.manifest({
                email: 'test@email.com',
                appUrl: 'test.com'
            });

            try {
                TrezorConnect.signTransaction({ inputs: inputs, outputs: outputs, coin: "Test", version: 2, locktime: 0 })
                    .then(function (response) {

                        if (response.success) {
                            
                            var stringed = JSON.stringify(response);
                           

                            var signResult = document.getElementById("signResult");
                            signResult.innerHTML = response.payload.serializedTx;
                          
                        } else {
                            alert(response.payload.error);
                            var stringed = JSON.stringify(response);
                           
                        }
                    });
            } catch (err) {
                alert(err);
            }
        };


    </script>
</body>

</html>
